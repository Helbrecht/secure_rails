class ParseManager::Malwaredb

	require 'open-uri'

	HTML = "http://malwaredb.malekal.com"

	SOURCE_SCORE = 1.0

	attr_accessor :records
	attr_accessor :html
	
	def initialize
		@records = []
		@html = "http://malwaredb.malekal.com/export.php?type=url"
	end

	def parse_sources
		page = Nokogiri::HTML(open(html))
		table_with_data = page.css("item")
		table_with_data.each_with_index do |item,index|
			break if index == 30
			values = {}
			values["date"] = item.css("date").text
			values["threat"] = item.css("category").text
			values["hostname"] = ParseManager::ParseHelper.replace_blank_hostnames(item.css("url").text)
			values["ip"] = item.css("ip").text
			values["source"] = ParseManager::Ransomware.to_s
			values["source_html"] = HTML
			@records << Record.new(values)
		end
		@records.map(&:save!)
		puts @records.count
	end


end